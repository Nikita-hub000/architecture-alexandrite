## Мотивация

Мониторинг даёт полную картину состояния системы и приносит бизнес-выгоды:
- позволяет быстро находить узкие места и снижать время восстановления (MTTR);
- помогает принимать решения о масштабировании и приоритизации работ;
- даёт основу для SLA/альертинга и уменьшает число инцидентов, влияющих на клиентов.


## Подход к мониторингу

RED:
- Requests Rate — частота запросов,
- Errors — ошибки,
- Duration — длительность.


## Метрики для отслеживания

Взаимодействие CRM и MES
- Количество писем в dead-letter (RabbitMQ) — сигнал о проблемных сообщениях, требующих внимания.
  - labels: topic
- Число сообщений «в полёте» (messages in flight) — сколько задач ожидают обработки.
  - labels: topic

CRM
- RPS (requests per second) — динамика нагрузки.
  - labels: code, method, url
- CPU % — загрузка CPU сервиса.
- Memory utilisation — использование оперативной памяти.
- Response time (latency) — время ответа по эндпоинтам.
  - labels: method, url

MES
- RPS для MES API — входящая нагрузка.
  - labels: code, method, url
- CPU % сервиса.
- Memory utilisation сервиса и базы данных.
- Число соединений к MES DB — нагрузка на БД.
- Размер БД — рост данных и потребность в хранении.
- Response time (латентность).
  - labels: method, url

Интернет-магазин (Shop)
- RPS для Shop API.
  - labels: code, method, url
- CPU % сервиса.
- Memory utilisation сервиса и базы данных.
- Число соединений к Shop DB.
- Размер Shop DB.
- Response time для Shop API.
  - labels: method, url

S3 / хранилище 3D-файлов
- Размер бакетов (bucket size) — контроль роста хранилища.
  - labels: bucket


## План действий

1. Развернуть Prometheus
   - внести в scrape_configs список целевых сервисов (shop-api, mes-api, crm-api, shop-db, mes-db);
   - настроить базовые правила алертов.
2. Развернуть Grafana и подключить к Prometheus
   - создать начальные дашборды для сервисов, очередей и БД.
3. Подготовить сервисы для экспорта метрик (экспортеры / instrumentation)
   - подключить node_exporter / postgres_exporter / rabbitmq_exporter;
   - добавить метрики в приложение (HTTP, расчёты цены, очередь задач).
4. Собрать и проанализировать метрики
   - откалибровать пороги алертов и уточнить labels/гранулярность.

